<?xml version="1.0"?>
<project default="test" name="coveralls">
  <target name="clean" description="Delete the generated files">
    <delete dir="doc/api" quiet="true"/>
    <delete dir="web" quiet="true"/>
    <delete includeEmptyDirs="true">
      <fileSet dir="var" includes="**/*" excludes=".gitkeep"/>
    </delete>
  </target>

  <target name="coverage" depends="test" description="Sends the results of the code coverage.">
    <exec executable="php" passthru="true">
      <arg value="bin/coveralls"/>
      <arg file="var/coverage.xml"/>
    </exec>
  </target>

  <target name="doc" description="Builds the documentation.">
    <exec executable="vendor/bin/apigen" passthru="true">
      <arg value="generate"/>
      <arg value="--destination=doc/api"/>
      <arg value="lib"/>
    </exec>
  </target>

  <target name="lint" description="Performs static analysis of source code.">
    <phpLint>
      <fileSet dir="bin" includes="coveralls"/>
      <fileSet dir="lib" includes="**/*.php"/>
      <fileSet dir="test" includes="**/*.php"/>
    </phpLint>
  </target>

  <target name="test" description="Runs the unit tests.">
    <exec executable="vendor/bin/phpunit" passthru="true">
      <arg value="--colors=auto"/>
      <arg value="--verbose"/>
    </exec>
  </target>
</project>
